<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login - Green Challenge</title>

<style>
body{
    margin:0;
    padding:0;
    background:#E8F5E9;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    font-family:Inter,Arial
}
.screen{
    width:100%;
    max-width:380px;
    background:white;
    padding:30px;
    border-radius:18px;
    box-shadow:0 8px 30px rgba(0,0,0,0.1);
    text-align:center
}
.logo{font-size:45px;margin-bottom:10px}
h2{color:#2E7D32;margin-bottom:5px}
p{color:#666;font-size:14px;margin-bottom:25px}
input{
    width:90%;
    padding:14px;
    border:2px solid #C8E6C9;
    border-radius:10px;
    margin-bottom:15px;
    font-size:15px;
    outline:none
}
button{
    width:90%;
    padding:14px;
    background:#4CAF50;
    color:white;
    border:none;
    border-radius:10px;
    font-size:16px;
    cursor:pointer;
    margin-top:10px;
    font-weight:bold
}
button:hover{background:#43A047}
.error{color:red;margin-top:10px;font-size:13px}
a{
    margin-top:15px;
    display:block;
    text-decoration:none;
    color:#4CAF50;
    font-size:14px
}
</style>
</head>

<body>
<div class="screen">
    <div class="logo">ðŸŒ¿</div>
    <h2>Green Challenge</h2>
    <p>Masukkan username dan password untuk melanjutkan</p>

    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>

    <a href="register.html">Belum punya akun? Register</a>

    <div class="error" id="errorMsg"></div>
</div>

<script>
async function login(){
    let username = document.getElementById("username").value.trim();
    let password = document.getElementById("password").value.trim();
    let error = document.getElementById("errorMsg");

    error.innerText = "";

    if(username.length < 3){
        error.innerText = "Username minimal 3 huruf!";
        return;
    }
    if(password.length < 4){
        error.innerText = "Password minimal 4 karakter!";
        return;
    }

    try {
        // CALL BACKEND API
        let res = await fetch("/api/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password })
        });

        let data = await res.json();

        if(!data.success){
            error.innerText = data.msg || "Login gagal";
            return;
        }

        // SIMPAN TOKEN & DATA USER
        localStorage.setItem("token", data.token);
        localStorage.setItem("greenUser", JSON.stringify(data.user));

        // PINDAH KE DASHBOARD
        window.location.href = "dashboard.html";
    }
    catch (err){
        console.log(err);
        error.innerText = "Terjadi kesalahan server";
    }
}
</script>

</body>
</html>
