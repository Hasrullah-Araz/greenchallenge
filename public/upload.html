<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Upload Proof</title>

<style>
    body {
        margin: 0;
        padding: 0;
        background: #E8F5E9;
        font-family: Inter, Arial;
        display: flex;
        justify-content: center;
    }

    .screen {
        max-width: 1100px;
        width: 100%;
        min-height: 844px;
        background: white;
        border-radius: 18px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        padding: 20px;
        box-sizing: border-box;
    }

    h2 {
        text-align: center;
        color: #4CAF50;
        margin: 0 0 20px;
    }

    input[type="file"] {
        width: 100%;
        padding: 12px;
        border-radius: 10px;
        border: 1px solid #CCC;
        margin-top: 10px;
    }

    .btn {
        width: 100%;
        background: #4CAF50;
        color: white;
        text-align: center;
        margin-top: 20px;
        padding: 12px;
        border-radius: 12px;
        font-weight: bold;
        text-decoration: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
    }
</style>

</head>
<body>

<div class="screen">
    <h2>Upload Proof</h2>

    <input type="file" id="proof" />
    <button id="uploadBtn" class="btn">Submit</button>

    <a href="dashboard.html"
        style="display:block;text-align:center;margin-top:20px;color:#4CAF50">&lt; Kembali</a>
</div>

<script>
document.getElementById("uploadBtn").addEventListener("click", async () => {

    const fileInput = document.getElementById("proof");
    if (fileInput.files.length === 0) {
        alert("Pilih file dulu!");
        return;
    }

    let user = JSON.parse(localStorage.getItem("greenUser") || "{}");
    if (!user.id) {
        alert("Anda harus login ulang");
        window.location.href = "login.html";
        return;
    }

    const form = new FormData();
    form.append("proof", fileInput.files[0]);
    form.append("user_id", user.id);

    try {
        const res = await fetch("http://localhost:3000/api/proof", {
            method: "POST",
            body: form
        });

        const data = await res.json();

        if (!data.success) {
            alert("Gagal upload");
            return;
        }

        // -------------------------
        // UPDATE STATISTIK USER
        // -------------------------
        user.points = (user.points || 0) + 10;
        user.proofs = (user.proofs || 0) + 1;
        user.storage = (user.storage || 0) + 1;

        // auto badge setiap 50 poin
        user.badges = Math.floor(user.points / 50);

        localStorage.setItem("greenUser", JSON.stringify(user));

        alert("Upload berhasil!");
        window.location.href = "dashboard.html";

    } catch (err) {
        console.error(err);
        alert("Terjadi error saat upload");
    }

});
</script>

</body>
</html>
